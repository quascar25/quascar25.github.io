<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title></title>
    <style>
        html, body {
            overflow: hidden;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            -webkit-overflow-scrolling: touch;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
        }
        
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        .star {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        #canvas3d {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }

        .app-content {
            position: absolute;
            top: 15vh;
            left: 0;
            width: 100%;
            text-align: center;
            opacity: 0;
            animation: contentAppear 0.5s 4.5s forwards;
            z-index: 100;
            pointer-events: none;
            overflow: hidden;
        }

        .app-content * {
            pointer-events: auto;
        }

        @keyframes contentAppear {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #c0c0c0;
            font-size: 18px;
            z-index: 1000;
        }

        /* Стили для интерфейса */
        .slogan {
            color: #c0c0c0;
            font-size: 16px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
        }

        .progress-container {
            width: 80%;
            max-width: 400px;
            height: 4px;
            background-color: #555;
            margin: 0 auto 20px;
            border-radius: 2px;
        }

        .progress-bar {
            height: 2px;
            background-color: #aaa;
            border-radius: 1px;
            margin: 1px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .buttons-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .role-btn {
            border: 1px solid #555;
            background: transparent;
            color: #c0c0c0;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .role-btn:active {
            border-color: #aaa;
            background-color: rgba(170, 170, 170, 0.1);
        }

        .role-btn.active {
            border-color: #aaa;
            background-color: rgba(170, 170, 170, 0.2);
        }

        .registration-container {
            margin-bottom: 20px;
        }

        .reg-btn {
            border: 1px solid #555;
            background: transparent;
            color: #c0c0c0;
            padding: 12px 30px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
            margin-bottom: 10px;
        }

        .reg-btn:active {
            border-color: #aaa;
        }

        .reg-form {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #555;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            animation: formAppear 0.3s ease;
        }

        @keyframes formAppear {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .form-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            border-radius: 3px;
            color: #fff;
            font-size: 14px;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .form-btn {
            padding: 5px 15px;
            border: 1px solid #555;
            background: transparent;
            color: #c0c0c0;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-btn:active {
            border-color: #aaa;
        }

        .registration-result {
            margin-top: 10px;
            font-size: 14px;
            color: #0f0;
            display: none;
            animation: resultAppear 0.5s ease;
        }

        @keyframes resultAppear {
            0% { opacity: 0; transform: translateY(-10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .map-section {
            margin: 20px 0;
        }

        .map-image {
            max-width: 90%;
            height: auto;
            border: 1px solid #555;
            border-radius: 4px;
            margin: 10px 0;
            opacity: 0;
            animation: imageAppear 0.5s 5s forwards;
        }

        @keyframes imageAppear {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
            margin-top: 20px;
        }

        .action-btn {
            border: 1px solid #555;
            background: transparent;
            color: #c0c0c0;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
            opacity: 0;
            animation: buttonAppear 0.5s ease forwards;
        }

        .action-btn:nth-child(1) { animation-delay: 5.1s; }
        .action-btn:nth-child(2) { animation-delay: 5.3s; }

        @keyframes buttonAppear {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="loading" id="loading"></div>
    <canvas id="canvas3d"></canvas>
    
    <!-- Контент приложения -->
    <div class="app-content">
        <h2 style="color: #c0c0c0; margin-bottom: 10px;">NOAGI Movement</h2>
        
        <div class="slogan">
            Все прогрессивные силы остановим новую угрозу, регистрируйтесь в "NOAGI"
        </div>

        <!-- Прогрессбар -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Кнопки выбора роли -->
        <div class="buttons-row">
            <button class="role-btn" data-role="member">Член $1K</button>
            <button class="role-btn" data-role="expert">Эксперт $0</button>
        </div>

        <!-- Регистрация -->
        <div class="registration-container">
            <button class="reg-btn" id="registrationBtn">Регистрация</button>
            
            <div class="reg-form" id="registrationForm">
                <input type="text" class="form-input" id="nameInput" placeholder="Имя">
                <input type="email" class="form-input" id="emailInput" placeholder="Почта">
                <input type="text" class="form-input" id="usernameInput" placeholder="Юзернейм">
                
                <div class="form-buttons">
                    <button class="form-btn" id="confirmBtn">Да</button>
                    <button class="form-btn" id="cancelBtn">Нет</button>
                </div>
            </div>

            <div class="registration-result" id="registrationResult"></div>
        </div>

        <!-- Карта -->
        <div class="map-section">
            <img src="map.png" alt="Карта движения" class="map-image" onerror="this.style.display='none'">
        </div>

        <!-- Дополнительные кнопки -->
        <div class="action-buttons">
            <button class="action-btn" id="expertsBtn">Наши эксперты</button>
            <button class="action-btn" id="contentBtn">Контент NOAGI</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Запрет скролла
        document.addEventListener('touchmove', function(e) {
            e.preventDefault();
        }, { passive: false });
        
        document.addEventListener('wheel', function(e) {
            e.preventDefault();
        }, { passive: false });

        // Создание звездного неба
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starsCount = 150;
            
            for (let i = 0; i < starsCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const size = Math.random() * 1.5 + 0.5;
                const delay = Math.random() * 4;
                
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.animationDelay = `${delay}s`;
                
                starsContainer.appendChild(star);
            }
        }

        // OBJ данные перечеркнутой надписи
        const objData = `v  258.394409 0.000000 144.246750
v  260.075562 0.000000 139.854095
v  267.722046 0.000000 139.854095
v  269.348969 0.000000 144.246750
v  273.524719 0.000000 144.246750
v  270.867432 0.000000 137.196793
v  275.151642 0.000000 137.142563
v  276.507385 0.000000 140.559082
v  278.568146 0.000000 142.836761
v  281.008514 0.000000 143.975601
v  283.774261 0.000000 144.517914
v  286.377350 0.000000 144.409454
v  288.438110 0.000000 143.921371
v  290.824249 0.000000 142.945221
v  292.885010 0.000000 141.589462
v  292.993469 0.000000 137.196793
v  296.409973 0.000000 137.196793
v  296.355743 0.000000 144.246750
v  300.314575 0.000000 144.246750
v  300.260345 0.000000 137.196793
v  308.177979 0.000000 137.142563
v  308.177979 0.000000 133.834503
v  300.206116 0.000000 133.942963
v  300.314575 0.000000 124.940704
v  296.409973 0.000000 124.994934
v  296.464203 0.000000 133.942963
v  278.893524 0.000000 133.997192
v  279.381592 0.000000 131.339905
v  280.737366 0.000000 129.224915
v  282.852356 0.000000 128.194534
v  285.509644 0.000000 128.031845
v  287.733093 0.000000 129.062225
v  288.871948 0.000000 130.960297
v  292.668060 0.000000 130.309525
v  291.854614 0.000000 128.031845
v  289.956543 0.000000 126.025314
v  287.570404 0.000000 124.940704
v  284.587738 0.000000 124.615326
v  281.605042 0.000000 124.886475
v  278.839294 0.000000 126.133774
v  276.778534 0.000000 128.140305
v  275.477020 0.000000 131.014526
v  275.043182 0.000000 133.942963
v  269.403198 0.000000 133.942963
v  265.986664 0.000000 124.940704
v  261.648254 0.000000 125.049164
v  258.285950 0.000000 133.888733
v  248.470230 0.000000 133.997192
v  248.416000 0.000000 137.196793
v  256.930176 0.000000 137.251022
v  254.218658 0.000000 144.246750
v  262.190552 0.000000 133.888733
v  263.708984 0.000000 129.496063
v  265.444366 0.000000 133.997192
v  279.273132 0.000000 137.196793
v  289.088867 0.000000 137.196793
v  289.143097 0.000000 139.582932
v  286.431580 0.000000 140.992935
v  283.394653 0.000000 141.209854
v  281.062744 0.000000 140.125244

f 52 1 2
f 50 51 1
f 50 1 52
f 4 5 6
f 3 4 6
f 52 2 3
f 54 52 3
f 54 3 6
f 33 34 35
f 32 33 35
f 32 35 36
f 32 36 37
f 31 32 37
f 31 37 38
f 30 31 38
f 30 38 39
f 30 39 40
f 29 30 40
f 29 40 41
f 28 29 41
f 28 41 42
f 27 28 42
f 27 42 43
f 23 24 25
f 23 25 26
f 21 22 23
f 20 21 23
f 48 49 50
f 47 48 50
f 47 50 52
f 46 47 52
f 46 52 53
f 45 46 53
f 44 45 53
f 44 53 54
f 44 54 55
f 43 44 55
f 27 43 55
f 26 27 55
f 26 55 56
f 18 19 20
f 17 18 20
f 17 20 23
f 17 23 26
f 16 17 26
f 16 26 56
f 15 16 56
f 15 56 57
f 14 15 57
f 13 14 57
f 13 57 58
f 12 13 58
f 12 58 59
f 11 12 59
f 10 11 59
f 10 59 60
f 9 10 60
f 8 9 60
f 8 60 55
f 7 8 55
f 7 55 54
f 7 54 6`;

        function parseOBJ(text) {
            const vertices = [];
            const faces = [];
            
            const lines = text.split('\n');
            for (const line of lines) {
                const parts = line.trim().split(/\s+/);
                if (parts[0] === 'v') {
                    vertices.push([
                        parseFloat(parts[1]),
                        parseFloat(parts[2]), 
                        parseFloat(parts[3])
                    ]);
                } else if (parts[0] === 'f') {
                    const face = [];
                    for (let i = 1; i < parts.length; i++) {
                        const indices = parts[i].split('/');
                        face.push(parseInt(indices[0]) - 1);
                    }
                    faces.push(face);
                }
            }
            
            return { vertices, faces };
        }

        // Создание 3D сцены
        let scene, camera, renderer, skullMesh, noagiMesh;
        let animationCompleted = false;

        function init() {
            // Сцена
            scene = new THREE.Scene();
            // scene.background = new THREE.Color(0x000000);

            // Камера
            const aspect = window.innerWidth / window.innerHeight;
            camera = new THREE.PerspectiveCamera(45, aspect, 0.1, 1000);
            camera.position.z = 8;

            // Рендерер
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('canvas3d'),
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            // Освещение
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            const directionalLight1 = new THREE.DirectionalLight(0xc0c0c0, 1);
            directionalLight1.position.set(2, 2, 2);
            scene.add(directionalLight1);

            const directionalLight2 = new THREE.DirectionalLight(0x808080, 0.5);
            directionalLight2.position.set(-2, -1, -1);
            scene.add(directionalLight2);

            // Создание мешей
            createMeshes();
            
            // Скрываем загрузку
            document.getElementById('loading').style.display = 'none';
            
            // Запуск анимации
            startAnimation();

            // Обработчик изменения размера
            window.addEventListener('resize', onWindowResize);
        }

        function createMeshes() {
            // Создание черепа из текстуры TERM.png
            const skullTextureLoader = new THREE.TextureLoader();
            
            // Создаем плоскость для черепа (ваши настройки)
            const skullGeometry = new THREE.PlaneGeometry(2, 3.12);
            const skullMaterial = new THREE.MeshBasicMaterial({ 
                map: skullTextureLoader.load('TERM.png'),
                transparent: true,
                opacity: 0,
                side: THREE.DoubleSide
            });
            
            skullMesh = new THREE.Mesh(skullGeometry, skullMaterial);
            skullMesh.scale.set(0, 0, 0);
            scene.add(skullMesh);

            // Создание надписи AGI из OBJ данных
            const { vertices, faces } = parseOBJ(objData);
            
            // Вычисляем границы для смещения
            let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
            for (const vertex of vertices) {
                minX = Math.min(minX, vertex[0]);
                maxX = Math.max(maxX, vertex[0]);
                minY = Math.min(minY, vertex[2]);
                maxY = Math.max(maxY, vertex[2]);
            }
            
            const width = maxX - minX;
            const height = maxY - minY;
            const centerX = (minX + maxX) / 2;
            const centerY = (minY + maxY) / 2;

            // Создание геометрии из OBJ данных
            const noagiGeometry = new THREE.BufferGeometry();
            const positionArray = new Float32Array(vertices.length * 3);
            
            // Нормализуем координаты, центрируем и смещаем (ваши настройки)
            for (let i = 0; i < vertices.length; i++) {
                const x = (vertices[i][0] - centerX) * 0.02;
                const y = (vertices[i][2] - centerY) * 0.02;
                
                // Ваши настройки смещения
                positionArray[i * 3] = x - width * 0.02 * 0.1;
                positionArray[i * 3 + 1] = y + height * 0.02 * 0.18;
                positionArray[i * 3 + 2] = vertices[i][1];
            }
            
            noagiGeometry.setAttribute('position', new THREE.BufferAttribute(positionArray, 3));
            
            // Создание индексов для faces
            const indices = [];
            for (const face of faces) {
                for (let i = 1; i < face.length - 1; i++) {
                    indices.push(face[0], face[i], face[i + 1]);
                }
            }
            noagiGeometry.setIndex(indices);
            noagiGeometry.computeVertexNormals();

            const noagiMaterial = new THREE.MeshPhongMaterial({
                color: 0xffffff, // Белый для лучшей видимости
                shininess: 80,
                transparent: true,
                opacity: 0,
                side: THREE.DoubleSide,
                emissive: 0x666666 // Добавляем свечение
            });

            noagiMesh = new THREE.Mesh(noagiGeometry, noagiMaterial);
            noagiMesh.scale.set(22, 22, 22); // Ваш начальный размер
            noagiMesh.rotation.x = Math.PI; // Поворот на 180 градусов по X
            scene.add(noagiMesh);
        }

        function startAnimation() {
            const timeline = [
                // 0-0.5s: Появление объектов (ваши настройки)
                { time: 0, skullScale: 0.8, noagiScale: 60, skullOpacity: 0, noagiOpacity: 0, noagiY: 0 },
                { time: 0.5, skullScale: 1, noagiScale: 60, skullOpacity: 0.9, noagiOpacity: 0, noagiY: 0 },
                
                // 0.5-3s: Масштабирование (ваши настройки)
                { time: 3, skullScale: 2, noagiScale: 2.5, skullOpacity: 1, noagiOpacity: 0.7, noagiY: 0 },
                
                // 3-4s: Исчезновение черепа и движение надписи вверх
                // ИСПРАВЛЕНИЕ: делаем надпись больше и ближе к центру
                { time: 4, skullScale: 2, noagiScale: 0.91, skullOpacity: 0, noagiOpacity: 0.7, noagiY: 3 }
            ];

            let startTime = Date.now();

            function animate() {
                const currentTime = (Date.now() - startTime) / 1000;
                
                // После завершения анимации скрываем череп
                if (currentTime > 4 && !animationCompleted) {
                    animationCompleted = true;
                    if (skullMesh) {
                        skullMesh.visible = false;
                    }
                    // Отладочная информация
                    console.log("Animation completed. AGI scale:", noagiMesh.scale.x, "position Y:", noagiMesh.position.y);
                }
                
                if (!animationCompleted) {
                    // Находим текущий и следующий ключевые кадры
                    let currentFrame = timeline[0];
                    let nextFrame = timeline[1];
                    
                    for (let i = 0; i < timeline.length - 1; i++) {
                        if (currentTime >= timeline[i].time && currentTime <= timeline[i + 1].time) {
                            currentFrame = timeline[i];
                            nextFrame = timeline[i + 1];
                            break;
                        }
                    }
                    
                    // Интерполяция между кадрами
                    const progress = Math.max(0, Math.min(1, 
                        (currentTime - currentFrame.time) / (nextFrame.time - currentFrame.time)
                    ));
                    
                    // Применение анимации к черепу
                    if (skullMesh) {
                        const skullScale = currentFrame.skullScale + (nextFrame.skullScale - currentFrame.skullScale) * progress;
                        skullMesh.scale.set(skullScale, skullScale, skullScale);
                        
                        const skullOpacity = currentFrame.skullOpacity + (nextFrame.skullOpacity - currentFrame.skullOpacity) * progress;
                        skullMesh.material.opacity = skullOpacity;
                    }
                    
                    // Применение анимации к надписи
                    if (noagiMesh) {
                        const noagiScale = currentFrame.noagiScale + (nextFrame.noagiScale - currentFrame.noagiScale) * progress;
                        noagiMesh.scale.set(noagiScale, noagiScale, noagiScale);
                        
                        const noagiOpacity = currentFrame.noagiOpacity + (nextFrame.noagiOpacity - currentFrame.noagiOpacity) * progress;
                        noagiMesh.material.opacity = noagiOpacity;
                        
                        const noagiY = currentFrame.noagiY + (nextFrame.noagiY - currentFrame.noagiY) * progress;
                        noagiMesh.position.y = noagiY;
                    }
                }
                
                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Функции для интерфейса
        function updateProgressBar() {
            const startDate = new Date('2025-10-20');
            const currentDate = new Date();
            const daysPassed = Math.max(0, Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24)));
            const progressWidth = Math.min((daysPassed / 365) * 100, 100);
            
            document.getElementById('progressBar').style.width = progressWidth + '%';
        }

        function encryptData(data) {
            // Простое шифрование для демонстрации
            return btoa(JSON.stringify(data));
        }

        function setupEventListeners() {
            // Кнопки ролей
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Кнопка регистрации
            const regBtn = document.getElementById('registrationBtn');
            const regForm = document.getElementById('registrationForm');
            const confirmBtn = document.getElementById('confirmBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const resultDiv = document.getElementById('registrationResult');

            regBtn.addEventListener('click', function() {
                if (regForm.style.display === 'block') {
                    regForm.style.display = 'none';
                } else {
                    regForm.style.display = 'block';
                    regBtn.textContent = 'Регистрация';
                    resultDiv.style.display = 'none';
                }
            });

            confirmBtn.addEventListener('click', function() {
                const name = document.getElementById('nameInput').value;
                const email = document.getElementById('emailInput').value;
                const username = document.getElementById('usernameInput').value;
                
                if (name && email && username) {
                    // Сохраняем в localStorage
                    const userData = { name, email, username, timestamp: new Date() };
                    const encrypted = encryptData(userData);
                    localStorage.setItem('noagi_registration', encrypted);
                    
                    // Показываем результат
                    const now = new Date();
                    const id = `ID${now.getHours()}${now.getMinutes()}/${now.getDate()}.${now.getMonth() + 1}.${now.getFullYear()}`;
                    resultDiv.innerHTML = `${id} ✓`;
                    resultDiv.style.display = 'block';
                    
                    // Сбрасываем форму
                    regForm.style.display = 'none';
                    regBtn.textContent = `${id} ✓`;
                }
            });

            cancelBtn.addEventListener('click', function() {
                regForm.style.display = 'none';
                regBtn.textContent = 'Регистрация';
                resultDiv.style.display = 'none';
            });

            // Дополнительные кнопки
            document.getElementById('expertsBtn').addEventListener('click', function() {
                alert('Раздел "Наши эксперты" в разработке');
            });

            document.getElementById('contentBtn').addEventListener('click', function() {
                alert('Раздел "Контент NOAGI" в разработке');
            });
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            createStars();
            setTimeout(() => {
                init();
                updateProgressBar();
                setupEventListeners();
            }, 100);
        });
    </script>
</body>
</html>
