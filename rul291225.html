<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Космическая Рулетка</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            color: #0af;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        #starfield {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Добавьте или убедитесь, что эти стили есть */
        #rouletteTable {
            position: relative !important; /* Ключевое свойство */
        }

        .container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            max-height: 700px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
        }
        /* Барабан рулетки */
        .wheel-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto;
        }
        .wheel {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #001122, #000);
            border-radius: 50%;
            border: 5px solid #0af;
            box-shadow: 0 0 20px #0088ff, inset 0 0 20px #001133;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .wheel-pointer {
            position: absolute;
            width: 20px;
            height: 30px;
            background: #ff3300;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            box-shadow: 0 0 10px red;
        }
        .wheel-numbers {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        .wheel-number {
            position: absolute;
            width: 18px;
            height: 18px;
            background: #222;
            border: 1px solid #0af;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            transform-origin: center;
            z-index: 1;
        }
        .wheel-number.winning {
            animation: numberGlow 1s infinite alternate;
        }
        @keyframes numberGlow {
            0% { box-shadow: 0 0 5px #ff0033, 0 0 10px #ff0033; }
            100% { box-shadow: 0 0 10px #ff0033, 0 0 20px #ff0033; }
        }
        /* Статистика */
        .stats-panel {
            background: rgba(0, 10, 30, 0.9);
            border: 2px solid #0af;
            padding: 5px;
            height: 40px;
            clip-path: polygon(5% 0, 95% 0, 100% 100%, 0 100%);
            box-shadow: 0 0 10px #0088ff;
        }
        .stats-title {
            color: #00f7ff;
            font-size: 0.7em;
            text-align: center;
            margin-bottom: 3px;
            text-shadow: 0 0 4px #00f7ff;
        }
        .stats-numbers {
            display: flex;
            justify-content: center;
            gap: 3px;
            flex-wrap: wrap;
        }
        .stat-number {
            width: 20px;
            height: 20px;
            background: rgba(0, 30, 60, 0.7);
            border: 1px solid #0af;
            color: #fff;
            font-size: 0.7em;
            display: flex;
            align-items: center;
            justify-content: center;
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
        }
        .stat-number.red { color: #ff6666; }
        .stat-number.black { color: #00aaff; }
        .stat-number.green { color: #33ff66; }
        /* Баланс */
        .balance-panel {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #ff0;
            padding: 8px;
            text-align: center;
            height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            clip-path: polygon(10% 0, 90% 0, 100% 30%, 100% 100%, 0 100%, 0 30%);
            box-shadow: 0 0 15px #ff0;
        }
        .balance-label {
            font-size: 0.8em;
            color: #ff0;
            text-shadow: 0 0 3px #ff0;
        }
        .balance-amount {
            font-size: 1.4em;
            font-weight: bold;
            color: #ff0;
            text-shadow: 0 0 8px #ff0;
        }
        .balance-panel.win {
            animation: winPulse 1s ease-out;
        }
        @keyframes winPulse {
            0% { box-shadow: 0 0 20px #ff0, 0 0 40px #ff0; transform: scale(1.05); }
            100% { box-shadow: 0 0 15px #ff0; transform: scale(1); }
        }
        /* Кнопки ставок */
        .bets-panel {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 5px 0;
        }
        .bet-button {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #001122, #003355);
            border: 2px solid #0af;
            color: #00f7ff;
            font-size: 1em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            clip-path: polygon(25% 0, 75% 0, 100% 50%, 75% 100%, 25% 100%, 0 50%);
            cursor: pointer;
            transition: all 0.2s;
        }
        .bet-button:hover {
            background: linear-gradient(135deg, #003355, #005588);
            box-shadow: 0 0 10px #0af;
        }
        .bet-button.active {
            background: linear-gradient(135deg, #005588, #00aaff);
            box-shadow: 0 0 15px #00f7ff;
            color: white;
        }
        /* Таблица рулетки */
        .table-container {
            background: rgba(0, 20, 40, 0.85);
            border: 3px solid #0af;
            padding: 8px;
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(13, 1fr);
            grid-template-rows: repeat(7, 1fr);
            gap: 4px;
            clip-path: polygon(3% 0, 97% 0, 100% 3%, 100% 97%, 97% 100%, 3% 100%, 0 97%, 0 3%);
            box-shadow: 0 0 10px #0088ff;
            position: relative;
        }
        .table-cell {
            background: rgba(0, 30, 60, 0.7);
            border: 1px solid #0af;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
            position: relative;
            transition: all 0.2s;
            cursor: pointer;
        }
        .table-cell:hover {
            background: rgba(0, 50, 100, 0.8);
            box-shadow: 0 0 8px #0af;
        }
        .table-cell.red {
            background: rgba(80, 0, 0, 0.7);
            color: #ff6666;
        }
        .table-cell.black {
            background: rgba(0, 0, 40, 0.7);
            color: #00aaff;
        }
        .table-cell.green {
            background: rgba(0, 60, 0, 0.7);
            color: #33ff66;
        }
        .table-cell.zero {
            grid-column: 1;
            grid-row: 2 / 8;
            font-size: 1.2em;
        }
        .table-cell.dozen {
            background: rgba(0, 40, 80, 0.7);
            font-size: 0.7em;
            text-align: center;
            padding: 2px;
        }
        .table-cell.column {
            background: rgba(0, 40, 80, 0.7);
            font-size: 0.7em;
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }
        .table-cell.outside {
            background: rgba(0, 40, 80, 0.7);
            font-size: 0.6em;
            text-align: center;
            padding: 2px;
        }
        /* Фишка */
        .chip {
            position: absolute;
            width: 22px;
            height: 22px;
            background: radial-gradient(circle at 30% 30%, #00aaff, #0055aa);
            border: 2px solid #00f7ff;
            border-radius: 50%;
            color: white;
            font-size: 0.6em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 8px #00aaff;
            z-index: 2;
        }

                    /* НОВЫЕ стили для пирамидки */
            .pyramid {
                position: absolute;
                width: 0;
                height: 0;
                border-left: 8px solid transparent;
                border-right: 8px solid transparent;
                border-bottom: 15px solid #FFD700;
                filter: drop-shadow(0 0 4px #FFD700);
                z-index: 9999;
                display: none;
                pointer-events: none;
                transform: translate(-50%, -50%);
                animation: pyramidGlow 1s infinite alternate; /* Добавлено */
            }

        

            .pyramid-in-cell {
                width: 15px;    /* Было 30px */
                height: 15px;   /* Было 30px */
                background: #FF0000;
                border-radius: 50%;
                border: 2px solid #FFFF00; /* Уменьшил с 3px */
                box-shadow: 0 0 8px #FF0000; /* Уменьшил свечение */
                display: block;
                margin: 0 auto;
            }
        

            @keyframes pyramidGlow {
                0% { 
                    opacity: 0.8; 
                    filter: drop-shadow(0 0 3px #FFD700);
                    border-bottom-color: #FFD700;
                }
                100% { 
                    opacity: 1; 
                    filter: drop-shadow(0 0 8px #FFD700);
                    border-bottom-color: #FFFF00; /* Светлее в пике */
                }
            }

        


        /* Инфо панель */
        .info-panel {
            background: rgba(0, 20, 40, 0.85);
            border: 2px solid #0af;
            padding: 8px;
            text-align: center;
            margin-top: 5px;
            clip-path: polygon(8% 0, 92% 0, 100% 25%, 100% 100%, 0 100%, 0 25%);
        }
        .info-text {
            font-size: 0.8em;
            margin: 3px 0;
        }
        .current-bet {
            color: #00f7ff;
            text-shadow: 0 0 5px #00f7ff;
        }
        .last-number {
            color: #33ff66;
            text-shadow: 0 0 5px #33ff66;
        }
        .message {
            color: #ff3366;
            text-shadow: 0 0 5px #ff3366;
            animation: flicker 1s infinite;
        }
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 5px;
        }
        .control-btn {
            padding: 5px 10px;
            font-size: 0.7em;
            cursor: pointer;
            clip-path: polygon(15% 0%, 85% 0%, 100% 50%, 85% 100%, 15% 100%, 0% 50%);
            transition: all 0.2s;
        }
        .spin-btn {
            background: rgba(80, 0, 80, 0.7);
            border: 1px solid #f0f;
            color: #f0f;
        }
        .clear-btn {
            background: rgba(60, 0, 0, 0.7);
            border: 1px solid #ff3366;
            color: #ff3366;
        }
        .control-btn:hover {
            box-shadow: 0 0 8px currentColor;
        }
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        @keyframes wheelSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(1440deg); }
        }

        
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    
    <div class="container">
        <!-- Барабан рулетки -->
        <div class="wheel-container">
            <div class="wheel">
                <div class="wheel-pointer"></div>
                <div class="wheel-numbers" id="wheelNumbers"></div>
            </div>
        </div>
        
        <!-- Статистика -->
        <div class="stats-panel">
            <div class="stats-title">ПОСЛЕДНИЕ 30 ЧИСЕЛ</div>
            <div class="stats-numbers" id="statsNumbers"></div>
        </div>
        
        <!-- Баланс -->
        <div class="balance-panel" id="balancePanel">
            <div class="balance-label">БАЛАНС</div>
            <div class="balance-amount" id="balanceAmount">1000</div>
        </div>
        
        <!-- Кнопки ставок -->
        <div class="bets-panel">
            <div class="bet-button active" data-bet="1">1</div>
            <div class="bet-button" data-bet="5">5</div>
            <div class="bet-button" data-bet="10">10</div>
            <div class="bet-button" data-bet="25">25</div>
            <div class="bet-button" data-bet="50">50</div>
            <div class="bet-button" data-bet="100">100</div>
        </div>
        
        <!-- Таблица рулетки -->
        <div class="table-container" id="rouletteTable">
            <!-- Таблица будет сгенерирована -->
        </div>
        
        <!-- Старая версия (замените на новую) -->
        <!-- <div class="vader" id="vader">
            <div class="vader-head"></div>
            <div class="vader-body"></div>
            <div class="vader-eyes">
                <div class="eye"></div>
                <div class="eye"></div>
            </div>
        </div> -->
        
        <!-- Новая версия - пирамидка -->
        <div class="pyramid" id="vader"></div>
        
        <!-- Инфо панель -->
        <div class="info-panel">
            <div class="info-text current-bet">ТЕКУЩАЯ СТАВКА: <span id="betAmount">0</span></div>
            <div class="info-text last-number">ПОСЛЕДНЕЕ ЧИСЛО: <span id="lastNum">–</span></div>
            <div class="info-text message" id="message">ВЫБЕРИТЕ РАЗМЕР СТАВКИ И КЛИКНИТЕ НА ЯЧЕЙКУ</div>
            <div class="control-buttons">
                <div class="control-btn clear-btn" id="clearBtn">ОЧИСТИТЬ</div>
                <div class="control-btn spin-btn" id="spinBtn">КРУТИТЬ</div>
            </div>
        </div>
    </div>

    <script>
        // Игровые переменные
        let balance = 1000;
        let currentBetSize = 1;
        let bets = {};
        let lastNumbers = [];
        let isSpinning = false;
        let resultNumber = null;
        let vaderVisible = false;
        


       // Цвета чисел
        
        const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        const colors = {};
        for (let i = 0; i <= 36; i++) {
            colors[i] = i === 0 ? 'green' : redNumbers.includes(i) ? 'red' : 'black';
        }
        
        // Коэффициенты выигрыша
        const betMultipliers = {
            straight: 35,
            split: 17,
            street: 11,
            corner: 8,
            line: 5,
            dozen: 2,
            column: 2,
            even: 1,
            odd: 1,
            red: 1,
            black: 1,
            low: 1,
            high: 1
        };

        // Звездное поле
        const starfield = document.getElementById('starfield');
        const starCtx = starfield.getContext('2d');
        const stars = [];
        
        function initStars() {
            starfield.width = window.innerWidth;
            starfield.height = window.innerHeight;
            
            for (let i = 0; i < 150; i++) {
                stars.push({
                    x: Math.random() * starfield.width,
                    y: Math.random() * starfield.height,
                    size: Math.random() * 1.2,
                    brightness: Math.random() * 0.5 + 0.5
                });
            }
            
            function drawStars() {
                starCtx.fillStyle = 'black';
                starCtx.fillRect(0, 0, starfield.width, starfield.height);
                
                stars.forEach(star => {
                    starCtx.beginPath();
                    starCtx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                    starCtx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    starCtx.fill();
                    
                    star.brightness = 0.3 + Math.abs(Math.sin(Date.now() / 1000 + star.x * 0.01)) * 0.7;
                });
                
                requestAnimationFrame(drawStars);
            }
            
            drawStars();
        }
        
        // Создаем числа на барабане
        function createWheelNumbers() {
            const wheelNumbers = document.getElementById('wheelNumbers');
            const numbers = [];
            
            for (let i = 0; i <= 36; i++) {
                numbers.push(i);
            }
            
            numbers.forEach((num, index) => {
                const numberDiv = document.createElement('div');
                numberDiv.className = 'wheel-number';
                
                if (num === 0) {
                    numberDiv.style.background = '#003300';
                    numberDiv.style.color = '#33ff66';
                } else if (redNumbers.includes(num)) {
                    numberDiv.style.background = '#330000';
                    numberDiv.style.color = '#ff6666';
                } else {
                    numberDiv.style.background = '#000022';
                    numberDiv.style.color = '#00aaff';
                }
                
                numberDiv.textContent = num;
                numberDiv.dataset.number = num;
                
                const angle = (index / 37) * 360;
                const radius = 75;
                const x = 90 + Math.cos(angle * Math.PI / 180) * radius;
                const y = 90 + Math.sin(angle * Math.PI / 180) * radius;
                
                numberDiv.style.left = (x - 9) + 'px';
                numberDiv.style.top = (y - 9) + 'px';
                
                wheelNumbers.appendChild(numberDiv);
            });
        }
        
        // Статистика
        function updateStats() {
            const statsNumbers = document.getElementById('statsNumbers');
            statsNumbers.innerHTML = '';
            
            lastNumbers.slice(-15).forEach(num => {
                const statDiv = document.createElement('div');
                statDiv.className = `stat-number ${colors[num]}`;
                statDiv.textContent = num;
                statsNumbers.appendChild(statDiv);
            });
        }
        
        // Создаем таблицу рулетки
        function createRouletteTable() {
            const table = document.getElementById('rouletteTable');
            
            // Ноль
            const zeroCell = createTableCell('0', 'cell zero green', '0');
            zeroCell.style.gridColumn = '1';
            zeroCell.style.gridRow = '2 / 8';
            table.appendChild(zeroCell);
            
            // Основные числа
            const numbers = [
                [3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36],
                [2, 5, 8, 11, 14, 17, 20, 23, 26, 29, 32, 35],
                [1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34]
            ];
            
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 12; col++) {
                    const num = numbers[row][col];
                    const colorClass = redNumbers.includes(num) ? 'red' : 'black';
                    const cell = createTableCell(num, `cell ${colorClass}`, `num_${num}`);
                    cell.style.gridColumn = col + 2;
                    cell.style.gridRow = row + 2;
                    cell.dataset.number = num;
                    cell.dataset.type = 'straight';
                    table.appendChild(cell);
                }
            }
            
            // Дюжины
            const dozens = [
                {text: '1-12', id: 'doz_1', start: 1, end: 12},
                {text: '13-24', id: 'doz_2', start: 13, end: 24},
                {text: '25-36', id: 'doz_3', start: 25, end: 36}
            ];
            
            for (let i = 0; i < 3; i++) {
                const cell = createTableCell(dozens[i].text, 'cell dozen', dozens[i].id);
                cell.style.gridColumn = `${2 + i*4} / span 4`;
                cell.style.gridRow = '1';
                cell.dataset.type = 'dozen';
                cell.dataset.range = `${dozens[i].start}-${dozens[i].end}`;
                table.appendChild(cell);
            }
            
            // Колонки
            for (let i = 0; i < 3; i++) {
                const cell = createTableCell('2:1', 'cell column', `col_${i+1}`);
                cell.style.gridColumn = '14';
                cell.style.gridRow = `${2 + i*2} / span 2`;
                cell.dataset.type = 'column';
                cell.dataset.index = i;
                table.appendChild(cell);
            }
            
            // Внешние ставки
            const outsideBets = [
                {text: '1-18', id: 'low', type: 'low'},
                {text: 'ЧЕТ', id: 'even', type: 'even'},
                {text: 'КРАС', id: 'red', type: 'red'},
                {text: 'ЧЕРН', id: 'black', type: 'black'},
                {text: 'НЕЧЕТ', id: 'odd', type: 'odd'},
                {text: '19-36', id: 'high', type: 'high'}
            ];
            
            outsideBets.forEach((bet, index) => {
                const cell = createTableCell(bet.text, 'cell outside', bet.id);
                cell.style.gridColumn = `${2 + index*2} / span 2`;
                cell.style.gridRow = '7';
                cell.dataset.type = bet.type;
                table.appendChild(cell);
            });
        }
        
        function createTableCell(text, className, id) {
            const cell = document.createElement('div');
            cell.className = `table-cell ${className}`;
            cell.textContent = text;
            cell.dataset.id = id;
            
            cell.addEventListener('click', () => {
                if (isSpinning) {
                    showMessage('Дождитесь окончания вращения!');
                    return;
                }
                if (vaderVisible) {
                    hideVader();
                    return;
                }
                placeBet(id);
            });
            
            return cell;
        }
        
        // Размещение ставки
        function placeBet(cellId) {
            if (balance < currentBetSize) {
                showMessage('Недостаточно средств!');
                return;
            }
            
            if (!bets[cellId]) {
                bets[cellId] = 0;
            }
            
            bets[cellId] += currentBetSize;
            balance -= currentBetSize;
            
            updateBalance();
            updateBetsDisplay();
            showMessage(`Ставка ${currentBetSize} на ${getBetName(cellId)}`);
        }
        
        function getBetName(cellId) {
            if (cellId === '0') return 'Ноль';
            if (cellId.startsWith('num_')) {
                return `Число ${cellId.split('_')[1]}`;
            }
            if (cellId === 'low') return '1-18';
            if (cellId === 'high') return '19-36';
            if (cellId === 'even') return 'Четные';
            if (cellId === 'odd') return 'Нечетные';
            if (cellId === 'red') return 'Красные';
            if (cellId === 'black') return 'Черные';
            if (cellId.startsWith('doz_')) {
                const num = cellId.split('_')[1];
                const ranges = ['1-12', '13-24', '25-36'];
                return `Дюжина ${ranges[num-1]}`;
            }
            if (cellId.startsWith('col_')) {
                const num = cellId.split('_')[1];
                return `Колонка ${num}`;
            }
            return cellId;
        }
        
        // Отображение фишек
        function updateBetsDisplay() {
            document.querySelectorAll('.chip').forEach(chip => chip.remove());
            
            let totalBet = 0;
            
            for (const [cellId, amount] of Object.entries(bets)) {
                if (amount > 0) {
                    totalBet += amount;
                    const cell = document.querySelector(`[data-id="${cellId}"]`);
                    if (cell) {
                        const chip = document.createElement('div');
                        chip.className = 'chip';
                        chip.textContent = amount;
                        chip.style.top = '50%';
                        chip.style.left = '50%';
                        chip.style.transform = 'translate(-50%, -50%)';
                        cell.appendChild(chip);
                    }
                }
            }
            
            document.getElementById('betAmount').textContent = totalBet;
        }
        
        // Обновление баланса
        function updateBalance() {
            document.getElementById('balanceAmount').textContent = balance;
        }
        
        // Показ сообщения
        function showMessage(text) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
        }
        
        // Вращение рулетки
        function spinWheel() {
            hideVader();
            if (isSpinning) return;
            
            const totalBet = Object.values(bets).reduce((sum, val) => sum + val, 0);
            if (totalBet === 0) {
                showMessage('Сделайте ставку перед вращением!');
                return;
            }
            
            isSpinning = true;
            showMessage('Вращение...');
            
            // Скрываем Вейдера если виден
            hideVader();
            
            // Анимация вращения барабана
            const wheelNumbers = document.getElementById('wheelNumbers');
            wheelNumbers.style.animation = 'wheelSpin 3s ease-out';
            
            // Случайный результат
            setTimeout(() => {
                resultNumber = Math.floor(Math.random() * 37);
                finishSpin();
            }, 3000);
        }
        
        // Завершение вращения
        function finishSpin() {
            isSpinning = false;
            
            // Останавливаем анимацию
            const wheelNumbers = document.getElementById('wheelNumbers');
            wheelNumbers.style.animation = '';
            
            // Добавляем число в статистику
            lastNumbers.push(resultNumber);
            if (lastNumbers.length > 30) lastNumbers.shift();
            updateStats();
            
            // Показываем результат
            document.getElementById('lastNum').textContent = resultNumber;
            document.getElementById('lastNum').className = colors[resultNumber];
            
            // Подсветка выигравшего числа на барабане
            highlightWinningNumber(resultNumber);
            
            // Расчет выигрыша
            const winAmount = calculateWin(resultNumber);
            
            if (winAmount > 0) {
                // Исправлено: добавляем и выигрыш, и ставки
                balance += winAmount;
                const balancePanel = document.getElementById('balancePanel');
                balancePanel.classList.add('win');
                setTimeout(() => balancePanel.classList.remove('win'), 1000);
                showMessage(`Выигрыш! +${winAmount}`);
            } else {
                showMessage(`Выпало ${resultNumber} - Вы проиграли`);
            }
            
            updateBalance();
            
            // ВАЖНО: Показываем пирамидку на выпавшем числе на таблице
            placeVaderOnTable(resultNumber);
            
            
            // Очищаем ставки
            bets = {};
            updateBetsDisplay();
        }
        
        // Подсветка выигравшего числа на барабане
        function highlightWinningNumber(number) {
            document.querySelectorAll('.wheel-number').forEach(el => {
                el.classList.remove('winning');
                if (parseInt(el.dataset.number) === number) {
                    el.classList.add('winning');
                }
            });
        }
        
        // Расчет выигрыша - ИСПРАВЛЕННАЯ ВЕРСИЯ
        function calculateWin(number) {
            let totalWin = 0;
            
            for (const [cellId, amount] of Object.entries(bets)) {
                if (isWinningBet(cellId, number)) {
                    const multiplier = getMultiplier(cellId);
                    // Исправлено: выигрыш = ставка * множитель + возврат ставки
                    totalWin += amount * (multiplier + 1);
                }
            }
            
            return totalWin;
        }
        
        function isWinningBet(cellId, number) {
            if (cellId === '0') return number === 0;
            
            if (cellId.startsWith('num_')) {
                const betNumber = parseInt(cellId.split('_')[1]);
                return betNumber === number;
            }
            
            if (cellId === 'low') return number >= 1 && number <= 18;
            if (cellId === 'high') return number >= 19 && number <= 36;
            if (cellId === 'even') return number !== 0 && number % 2 === 0;
            if (cellId === 'odd') return number !== 0 && number % 2 === 1;
            if (cellId === 'red') return redNumbers.includes(number);
            if (cellId === 'black') return number !== 0 && !redNumbers.includes(number);
            
            if (cellId.startsWith('doz_')) {
                const dozenNum = parseInt(cellId.split('_')[1]);
                if (dozenNum === 1) return number >= 1 && number <= 12;
                if (dozenNum === 2) return number >= 13 && number <= 24;
                if (dozenNum === 3) return number >= 25 && number <= 36;
            }
            
            if (cellId.startsWith('col_')) {
                const colNum = parseInt(cellId.split('_')[1]);
                const col1 = [3,6,9,12,15,18,21,24,27,30,33,36];
                const col2 = [2,5,8,11,14,17,20,23,26,29,32,35];
                const col3 = [1,4,7,10,13,16,19,22,25,28,31,34];
                
                if (colNum === 1) return col1.includes(number);
                if (colNum === 2) return col2.includes(number);
                if (colNum === 3) return col3.includes(number);
            }
            
            return false;
        }
        
        function getMultiplier(cellId) {
            if (cellId === '0' || cellId.startsWith('num_')) return betMultipliers.straight;
            if (cellId.startsWith('doz_') || cellId.startsWith('col_')) return betMultipliers.dozen;
            return 1;
        }
        
          function placeVaderOnTable(number) {
            console.log('placeVaderOnTable вызвана с number =', number);
            
            const pyramid = document.getElementById('vader');
            
            if (number === null) {
                pyramid.style.display = 'none';
                return;
            }
            
            // Находим ячейку с этим числом
            let targetCell;
            if (number === 0) {
                targetCell = document.querySelector('[data-id="0"]');
            } else {
                targetCell = document.querySelector(`[data-id="num_${number}"]`);
            }
            
            console.log('targetCell найден?', !!targetCell);
            
            if (targetCell) {
                // Самый простой способ - используем offsetParent
                const table = document.getElementById('rouletteTable');
                
                // Убедимся, что пирамидка внутри таблицы
                if (pyramid.parentElement !== table) {
                    table.appendChild(pyramid);
                }

        // Позиция относительно таблицы
        const left = targetCell.offsetLeft;
        const top = targetCell.offsetTop;

                
                // Позиция относительно таблицы
                // ОРИГИНАЛЬНЫЕ КООРДИНАТЫ (центр ячейки):
                // const left = targetCell.offsetLeft + (targetCell.offsetWidth / 2);
                // const top = targetCell.offsetTop + (targetCell.offsetHeight / 2);
                

                
                console.log('Координаты:', left, 'px,', top, 'px');
                console.log('Размеры ячейки:', targetCell.offsetWidth, 'x', targetCell.offsetHeight);
                
                pyramid.style.left = left + 'px';
                pyramid.style.top = top + 'px';
                pyramid.style.display = 'block';
                pyramid.style.position = 'absolute';
                vaderVisible = true;
            }
        }
        
        
        // Скрытие Вейдера
        function hideVader() {
            const pyramid = document.getElementById('vader');
            pyramid.style.display = 'none';
            vaderVisible = false;
        }
        
        // Очистка ставок
        function clearBets() {
            if (isSpinning) {
                showMessage('Дождитесь окончания вращения!');
                return;
            }
            
            if (vaderVisible) {
                hideVader();
                return;
            }
            
            // Возвращаем деньги
            const totalBet = Object.values(bets).reduce((sum, val) => sum + val, 0);
            balance += totalBet;
            
            bets = {};
            updateBetsDisplay();
            updateBalance();
            showMessage('Ставки очищены');
        }
        
        // Инициализация
        function init() {
            initStars();
            createWheelNumbers();
            createRouletteTable();
            updateStats();
            updateBalance();
            
            // Кнопки размера ставки
            document.querySelectorAll('.bet-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (vaderVisible) {
                        hideVader();
                        return;
                    }
                    
                    document.querySelectorAll('.bet-button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentBetSize = parseInt(btn.dataset.bet);
                    showMessage(`Размер ставки: ${currentBetSize}`);
                });
            });
            
                // Кнопка вращения
                document.getElementById('spinBtn').addEventListener('click', () => {
                    if (vaderVisible) {
                        hideVader();
                        return;
                    }
                    spinWheel();
                });
            
            // Кнопка очистки
                // Кнопка очистки
                document.getElementById('clearBtn').addEventListener('click', () => {
                    if (vaderVisible) {
                        hideVader();
                        return;
                    }
                    clearBets();
                });
            
            // Клик на барабан
            document.querySelector('.wheel').addEventListener('click', () => {
                if (vaderVisible) {
                    hideVader();
                    return;
                }
                if (!isSpinning) {
                    spinWheel();
                }
            });
            
            window.addEventListener('resize', initStars);
        }


            // Скрытие Вейдера
            function hideVader() {
                const vader = document.getElementById('vader');
                vader.style.display = 'none';
                vaderVisible = false;
            }

        
        init();
    </script>
</body>
</html>
