<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Космическая Рулетка</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            color: #0af;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            padding: 5px;
        }
        #starfield {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .wheel-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto;
        }
        #wheelCanvas {
            background: radial-gradient(circle at center, #001122, #000);
            border-radius: 50%;
            border: 4px solid #0af;
            box-shadow: 0 0 15px #0088ff, inset 0 0 15px #001133;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        #vader {
            position: absolute;
            width: 25px;
            height: 40px;
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            z-index: 10;
            filter: drop-shadow(0 0 4px red);
            display: none;
        }
        .vader-body {
            position: absolute;
            width: 20px;
            height: 30px;
            background: #111;
            clip-path: polygon(20% 0, 80% 0, 100% 20%, 100% 100%, 0 100%, 0 20%);
            left: 2.5px;
            top: 0;
        }
        .vader-head {
            position: absolute;
            width: 25px;
            height: 12px;
            background: #000;
            clip-path: polygon(20% 0, 80% 0, 100% 100%, 0 100%);
            top: -10px;
        }
        .vader-eyes {
            position: absolute;
            width: 100%;
            height: 5px;
            top: 4px;
            display: flex;
            justify-content: space-around;
        }
        .eye {
            width: 4px;
            height: 4px;
            background: #ff0033;
            border-radius: 50%;
            animation: eyeGlow 0.5s infinite alternate;
            box-shadow: 0 0 6px red;
        }
        @keyframes eyeGlow {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        .stats-panel {
            background: rgba(0, 10, 30, 0.9);
            border: 1px solid #0af;
            padding: 3px;
            height: 40px;
            clip-path: polygon(3% 0, 97% 0, 100% 100%, 0 100%);
            box-shadow: 0 0 5px #0088ff;
        }
        .stats-title {
            color: #00f7ff;
            font-size: 0.7em;
            text-align: center;
            margin-bottom: 2px;
            text-shadow: 0 0 3px #00f7ff;
        }
        #statsGrid {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 2px;
            font-size: 0.6em;
        }
        .stat-number {
            padding: 2px 0;
            background: rgba(0, 30, 60, 0.7);
            border: 1px solid #0af;
            color: #fff;
            font-weight: bold;
            clip-path: polygon(20% 0%, 80% 0%, 100% 50%, 80% 100%, 20% 100%, 0% 50%);
            text-align: center;
        }
        .red { color: #ff3366; }
        .black { color: #00f7ff; }
        .green { color: #33ff66; }
        .balance-panel {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ff0;
            padding: 5px;
            text-align: center;
            height: 35px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            clip-path: polygon(10% 0, 90% 0, 100% 30%, 100% 100%, 0 100%, 0 30%);
            box-shadow: 0 0 10px #ff0;
            transition: all 0.3s;
        }
        .balance-label {
            font-size: 0.7em;
            color: #ff0;
            text-shadow: 0 0 3px #ff0;
        }
        #balance {
            font-size: 1.2em;
            font-weight: bold;
            color: #ff0;
            text-shadow: 0 0 8px #ff0;
        }
        .balance-panel.win {
            animation: winGlow 1s ease-out;
        }
        @keyframes winGlow {
            0% { box-shadow: 0 0 20px #ff0, 0 0 40px #ff0; }
            100% { box-shadow: 0 0 10px #ff0; }
        }
        .table-container {
            background: rgba(0, 20, 40, 0.85);
            border: 3px solid #0af;
            padding: 8px;
            flex-grow: 1;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 4px;
            clip-path: polygon(2% 0, 98% 0, 100% 3%, 100% 97%, 98% 100%, 2% 100%, 0 97%, 0 3%);
            box-shadow: 0 0 10px #0088ff;
        }
        .table-cell {
            background: rgba(0, 30, 60, 0.7);
            border: 1px solid #0af;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
            clip-path: polygon(15% 0%, 85% 0%, 100% 15%, 100% 85%, 85% 100%, 15% 100%, 0% 85%, 0% 15%);
        }
        .table-cell:hover {
            background: rgba(0, 50, 100, 0.9);
            box-shadow: 0 0 6px #0af;
        }
        .chip {
            position: absolute;
            width: 24px;
            height: 24px;
            background: radial-gradient(circle at 30% 30%, #00aaff, #0055aa);
            border: 2px solid #00f7ff;
            border-radius: 50%;
            color: white;
            font-size: 0.7em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 8px #00aaff;
            z-index: 5;
        }
        .info-panel {
            background: rgba(0, 20, 40, 0.85);
            border: 2px solid #0af;
            padding: 5px;
            text-align: center;
            font-size: 0.8em;
            margin-top: 5px;
            clip-path: polygon(8% 0, 92% 0, 100% 25%, 100% 100%, 0 100%, 0 25%);
        }
        #currentBet, #lastNumber, #message {
            margin: 2px 0;
            min-height: 1.2em;
        }
        #currentBet {
            color: #00f7ff;
            text-shadow: 0 0 4px #00f7ff;
        }
        #lastNumber {
            color: #33ff66;
            text-shadow: 0 0 4px #33ff66;
        }
        #message {
            color: #ff3366;
            text-shadow: 0 0 4px #ff3366;
            animation: flicker 1s infinite;
        }
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .clear-btn {
            background: rgba(100, 0, 0, 0.7);
            border: 1px solid #ff3366;
            color: #ff3366;
            padding: 4px 8px;
            margin-top: 5px;
            cursor: pointer;
            font-size: 0.8em;
            clip-path: polygon(20% 0%, 80% 0%, 100% 50%, 80% 100%, 20% 100%, 0% 50%);
            transition: all 0.2s;
        }
        .clear-btn:hover {
            background: rgba(150, 0, 0, 0.9);
            box-shadow: 0 0 8px #ff3366;
        }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    <div class="container">
        <div class="wheel-container">
            <canvas id="wheelCanvas" width="180" height="180"></canvas>
            <div id="vader">
                <div class="vader-head"></div>
                <div class="vader-body"></div>
                <div class="vader-eyes">
                    <div class="eye"></div>
                    <div class="eye"></div>
                </div>
            </div>
        </div>
        
        <div class="stats-panel">
            <div class="stats-title">ИСТОРИЯ</div>
            <div id="statsGrid"></div>
        </div>
        
        <div class="balance-panel" id="balancePanel">
            <div class="balance-label">БАЛАНС</div>
            <div id="balance">1000</div>
        </div>
        
        <div class="table-container" id="tableContainer">
            <!-- 37 ячеек от 0 до 36 -->
        </div>
        
        <div class="info-panel">
            <div>СТАВКА: <span id="currentBet">0</span></div>
            <div>ПОСЛЕДНЕЕ: <span id="lastNumber">–</span></div>
            <div id="message">КЛИКНИТЕ НА ЯЧЕЙКИ СТОЛА ДЛЯ СТАВКИ</div>
            <div class="clear-btn" id="clearBtn">ОЧИСТИТЬ СТАВКИ</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const starfield = document.getElementById('starfield');
        const statsGrid = document.getElementById('statsGrid');
        const tableContainer = document.getElementById('tableContainer');
        const balanceEl = document.getElementById('balance');
        const balancePanel = document.getElementById('balancePanel');
        const currentBetEl = document.getElementById('currentBet');
        const lastNumberEl = document.getElementById('lastNumber');
        const messageEl = document.getElementById('message');
        const vader = document.getElementById('vader');
        const clearBtn = document.getElementById('clearBtn');

        let balance = 1000;
        let totalBet = 0;
        let bets = {}; // {number: amount}
        let lastNumbers = [];
        let isSpinning = false;
        let wheelAngle = 0;
        let targetAngle = 0;
        let spinAnimationId = null;
        let resultNumber = null;

        const colors = {};
        const redNumbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        for (let i = 0; i <= 36; i++) {
            colors[i] = i === 0 ? 'green' : redNumbers.includes(i) ? 'red' : 'black';
        }

        const betMultipliers = {
            straight: 35,    // Ставка на число
            split: 17,       // 2 числа
            street: 11,      // 3 числа
            corner: 8,       // 4 числа
            dozen: 2,        // дюжина
            column: 2,       // колонка
            evenOdd: 1,      // чет/нечет
            redBlack: 1,     // красное/черное
            half: 1          // 1-18/19-36
        };

        function initStarfield() {
            starfield.width = window.innerWidth;
            starfield.height = window.innerHeight;
            const starCtx = starfield.getContext('2d');
            const stars = [];
            for (let i = 0; i < 120; i++) {
                stars.push({
                    x: Math.random() * starfield.width,
                    y: Math.random() * starfield.height,
                    size: Math.random() * 1,
                    brightness: Math.random()
                });
            }
            function drawStars() {
                starCtx.fillStyle = 'black';
                starCtx.fillRect(0, 0, starfield.width, starfield.height);
                stars.forEach(star => {
                    starCtx.beginPath();
                    starCtx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                    starCtx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    starCtx.fill();
                    star.brightness = 0.1 + Math.abs(Math.sin(Date.now() / 1500 + star.x)) * 0.9;
                });
                requestAnimationFrame(drawStars);
            }
            drawStars();
        }

        function createTable() {
            tableContainer.innerHTML = '';
            const numbers = [
                [0, 1, 2, 3, 4, 5, 6],
                [7, 8, 9, 10, 11, 12, 13],
                [14, 15, 16, 17, 18, 19, 20],
                [21, 22, 23, 24, 25, 26, 27],
                [28, 29, 30, 31, 32, 33, 34],
                [35, 36]
            ];
            
            for (let row = 0; row < numbers.length; row++) {
                for (let col = 0; col < 7; col++) {
                    if (numbers[row][col] !== undefined) {
                        const num = numbers[row][col];
                        const cell = document.createElement('div');
                        cell.className = `table-cell ${colors[num]}`;
                        cell.textContent = num;
                        cell.dataset.number = num;
                        
                        // Расчет позиции в сетке 6x7
                        cell.style.gridColumn = col + 1;
                        cell.style.gridRow = row + 1;
                        
                        if (row === 5 && col >= 2) {
                            // Для последней строки (только 35 и 36) центрируем
                            if (num === 35) {
                                cell.style.gridColumn = '3';
                            } else if (num === 36) {
                                cell.style.gridColumn = '5';
                            }
                        }
                        
                        tableContainer.appendChild(cell);
                        
                        cell.addEventListener('click', () => placeBet(num));
                    }
                }
            }
            updateBetsDisplay();
        }

        function placeBet(number) {
            if (isSpinning) {
                messageEl.textContent = 'ДОЖДИТЕСЬ ОКОНЧАНИЯ ВРАЩЕНИЯ';
                return;
            }
            
            if (balance < 1) {
                messageEl.textContent = 'НЕДОСТАТОЧНО СРЕДСТВ';
                return;
            }
            
            if (!bets[number]) bets[number] = 0;
            bets[number]++;
            balance--;
            totalBet++;
            
            updateBetsDisplay();
            updateBalance();
            messageEl.textContent = `СТАВКА ${bets[number]} НА ЧИСЛО ${number}`;
        }

        function updateBetsDisplay() {
            document.querySelectorAll('.chip').forEach(chip => chip.remove());
            
            for (const [number, amount] of Object.entries(bets)) {
                if (amount > 0) {
                    const cell = document.querySelector(`[data-number="${number}"]`);
                    if (cell) {
                        const chip = document.createElement('div');
                        chip.className = 'chip';
                        chip.textContent = amount;
                        chip.style.top = '50%';
                        chip.style.left = '50%';
                        chip.style.transform = 'translate(-50%, -50%)';
                        cell.appendChild(chip);
                    }
                }
            }
            
            currentBetEl.textContent = totalBet;
        }

        function updateBalance() {
            balanceEl.textContent = balance;
        }

        function drawWheel(angle = 0) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 80;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(angle);

            const totalNumbers = 37;
            const sliceAngle = (2 * Math.PI) / totalNumbers;
            
            for (let i = 0; i < totalNumbers; i++) {
                const num = i;
                const startAngle = i * sliceAngle;
                const endAngle = startAngle + sliceAngle;
                
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.arc(0, 0, radius, startAngle, endAngle);
                ctx.closePath();
                
                ctx.fillStyle = colors[num] === 'red' ? '#330000' : 
                               colors[num] === 'black' ? '#000a1a' : '#003300';
                ctx.fill();
                
                ctx.strokeStyle = '#0af';
                ctx.lineWidth = 1;
                ctx.stroke();

                ctx.save();
                ctx.rotate(startAngle + sliceAngle / 2);
                ctx.translate(radius * 0.7, 0);
                ctx.rotate(Math.PI / 2);
                
                ctx.fillStyle = colors[num] === 'red' ? '#ff3366' : 
                               colors[num] === 'black' ? '#00aaff' : '#33ff66';
                ctx.font = 'bold 10px Courier New';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(num.toString(), 0, 0);
                ctx.restore();
            }

            ctx.restore();

            ctx.beginPath();
            ctx.arc(centerX, centerY, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#0af';
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(centerX, centerY - 8);
            ctx.lineTo(centerX, centerY - radius + 8);
            ctx.lineTo(centerX + 6, centerY - radius + 16);
            ctx.lineTo(centerX - 6, centerY - radius + 16);
            ctx.closePath();
            ctx.fillStyle = '#ff3300';
            ctx.fill();
        }

        function updateStats() {
            statsGrid.innerHTML = '';
            lastNumbers.slice(-30).forEach(num => {
                const div = document.createElement('div');
                div.className = `stat-number ${colors[num]}`;
                div.textContent = num;
                statsGrid.appendChild(div);
            });
        }

        function placeVader(number) {
            if (number === null) {
                vader.style.display = 'none';
                return;
            }
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 80;
            const totalNumbers = 37;
            const sliceAngle = (2 * Math.PI) / totalNumbers;
            const index = number;
            const angle = index * sliceAngle + sliceAngle / 2 - wheelAngle;
            const x = centerX + Math.cos(angle) * radius * 0.85;
            const y = centerY + Math.sin(angle) * radius * 0.85;
            vader.style.left = (x - 12.5) + 'px';
            vader.style.top = (y - 20) + 'px';
            vader.style.display = 'block';
        }

        function calculateWin(number) {
            let winAmount = 0;
            
            if (bets[number]) {
                winAmount += bets[number] * betMultipliers.straight;
            }
            
            return winAmount;
        }

        function spinWheel() {
            if (isSpinning) return;
            if (totalBet === 0) {
                messageEl.textContent = 'СДЕЛАЙТЕ СТАВКУ ПЕРЕД ВРАЩЕНИЕМ';
                return;
            }
            if (balance < 0) {
                messageEl.textContent = 'НЕДОСТАТОЧНО СРЕДСТВ';
                return;
            }
            
            isSpinning = true;
            vader.style.display = 'none';
            messageEl.textContent = 'ВРАЩЕНИЕ...';

            resultNumber = Math.floor(Math.random() * 37);
            const totalNumbers = 37;
            const sliceAngle = (2 * Math.PI) / totalNumbers;
            targetAngle = wheelAngle + 6 * Math.PI + (resultNumber * sliceAngle + sliceAngle / 2);

            function animate() {
                const diff = targetAngle - wheelAngle;
                if (Math.abs(diff) < 0.01) {
                    wheelAngle = targetAngle;
                    drawWheel(wheelAngle);
                    finishSpin();
                    return;
                }
                wheelAngle += diff * 0.05;
                drawWheel(wheelAngle);
                spinAnimationId = requestAnimationFrame(animate);
            }
            animate();
        }

        function finishSpin() {
            isSpinning = false;
            lastNumbers.push(resultNumber);
            if (lastNumbers.length > 30) lastNumbers.shift();
            
            const winAmount = calculateWin(resultNumber);
            
            if (winAmount > 0) {
                balance += winAmount;
                balancePanel.classList.add('win');
                setTimeout(() => balancePanel.classList.remove('win'), 1000);
                messageEl.textContent = `ВЫИГРЫШ! +${winAmount}`;
            } else {
                messageEl.textContent = `ВЫПАЛО ${resultNumber} - ВЫ ПРОИГРАЛИ`;
            }
            
            updateStats();
            updateBalance();
            lastNumberEl.textContent = resultNumber;
            lastNumberEl.className = colors[resultNumber];
            placeVader(resultNumber);
            
            bets = {};
            totalBet = 0;
            updateBetsDisplay();
        }

        function init() {
            initStarfield();
            createTable();
            drawWheel();
            updateStats();
            updateBalance();
            
            canvas.addEventListener('click', spinWheel);
            
            clearBtn.addEventListener('click', () => {
                if (isSpinning) return;
                
                for (const number in bets) {
                    balance += bets[number];
                }
                bets = {};
                totalBet = 0;
                
                updateBetsDisplay();
                updateBalance();
                messageEl.textContent = 'СТАВКИ ОЧИЩЕНЫ';
            });
            
            window.addEventListener('resize', initStarfield);
        }

        init();
    </script>
</body>
</html>
