<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Connections - Знакомства</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>
    <div class="starships">
        <div class="starship" id="starship1">⎈</div>
        <div class="starship" id="starship2">⎈</div>
        <div class="starship" id="starship3">⎈</div>
    </div>

    <div class="container">
        <!-- Профиль пользователя -->
        <div class="profile-section">
            <div class="profile-header">
                <h1>🌌 Cosmic Connections</h1>
                <div class="user-profile">
                    <div class="avatar-container">
                        <img id="userAvatar" src="" alt="Ваш аватар" class="avatar">
                        <input type="file" id="avatarUpload" accept="image/*" multiple style="display: none;">
                        <button onclick="document.getElementById('avatarUpload').click()" class="upload-btn">
                            📷 Загрузить фото (макс. 5)
                        </button>
                    </div>
                    <div class="photo-preview" id="photoPreview"></div>
                </div>
            </div>
        </div>

        <!-- Чат -->
        <div class="chat-section">
            <div class="chat-header">
                <h2>💫 Галактический чат</h2>
                <div class="online-count">👥 Онлайн: <span id="onlineCount">1</span></div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="system-message">
                    🌟 Добро пожаловать в космический чат! Вы видите всех, другие видят только вас.
                </div>
            </div>

            <div class="chat-input-container">
                <div class="emoji-picker">
                    <button onclick="toggleEmojiPicker()">😊</button>
                    <div class="emoji-grid" id="emojiGrid">
                        <span onclick="addEmoji('😊')">😊</span>
                        <span onclick="addEmoji('😂')">😂</span>
                        <span onclick="addEmoji('❤️')">❤️</span>
                        <span onclick="addEmoji('👍')">👍</span>
                        <span onclick="addEmoji('🎉')">🎉</span>
                        <span onclick="addEmoji('🌟')">🌟</span>
                        <span onclick="addEmoji('🚀')">🚀</span>
                        <span onclick="addEmoji('💫')">💫</span>
                        <span onclick="addEmoji('👋')">👋</span>
                        <span onclick="addEmoji('😍')">😍</span>
                        <span onclick="addEmoji('😎')">😎</span>
                        <span onclick="addEmoji('🤔')">🤔</span>
                        <span onclick="addEmoji('🎈')">🎈</span>
                        <span onclick="addEmoji('📸')">📸</span>
                        <span onclick="addEmoji('🌙')">🌙</span>
                        <span onclick="addEmoji('☀️')">☀️</span>
                    </div>
                </div>
                <input type="text" id="messageInput" placeholder="Введите сообщение..." maxlength="500">
                <button onclick="sendMessage()" class="send-btn">📤</button>
            </div>
        </div>

        <!-- Участники чата -->
        <div class="participants-section">
            <h3>👽 Участники чата</h3>
            <div class="participants-list" id="participantsList">
                <div class="participant you">
                    <div class="participant-avatar">👤</div>
                    <div class="participant-info">
                        <div class="participant-name">Вы</div>
                        <div class="participant-status online">online</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
        <!-- Подключаем Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <script>
      // Вставьте сюда скопированную конфигурацию
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyChVNJexhWHuV9KCv52VssFA1MvYaRulBk",
          authDomain: "jetchat-481ee.firebaseapp.com",
          projectId: "jetchat-481ee",
          storageBucket: "jetchat-481ee.firebasestorage.app",
          messagingSenderId: "180249150993",
          appId: "1:180249150993:web:eaeb4ed6165f6f16fe53b0",
          measurementId: "G-75MCW0R6ED"
        };
    
      // Инициализируем Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const database = firebase.database();

      /////
        // Ссылки на разделы базы данных
        const messagesRef = database.ref('messages');
        const usersRef = database.ref('users');
        
        // Функция для отправки сообщения
            function sendMessage(userId, userName, text) {
              // Проверяем, что все параметры переданы
              if (!userId || !userName || !text) {
                console.error('❌ Ошибка: все параметры должны быть заданы');
                console.log('userId:', userId, 'userName:', userName, 'text:', text);
                return;
              }
              
              const message = {
                senderId: userId,
                senderName: userName,
                text: text,
                timestamp: Date.now()
              };
              
              console.log('📤 Отправляем сообщение:', message);
              messagesRef.push(message)
                .then(() => console.log('✅ Сообщение отправлено!'))
                .catch(error => console.error('❌ Ошибка отправки:', error));
            }
        
        // Функция для чтения сообщений в реальном времени
        function setupChatListener() {
          messagesRef.limitToLast(20).on('value', (snapshot) => {
            console.log('📨 Новые сообщения:', snapshot.val());
          });
        }
        
        // Инициализируем прослушиватель сообщений
        setupChatListener();
      /////
        
    </script>
    
</body>
</html>
