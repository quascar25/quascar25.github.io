<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">
    <title>Donut Lab ‚Ä¢ VTT ‚Ä¢ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª ‚Ä¢ –∏–Ω–≤–µ—Å—Ç–æ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        body {
            min-height: 100vh;
            background: radial-gradient(ellipse at 50% 30%, #0b1425, #02040c);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
            position: relative;
            overflow-x: hidden;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: #b5d0ff;
            border-radius: 50%;
            box-shadow: 0 0 14px 3px #6080d0;
            animation: glitter 5s infinite ease-in-out;
        }

        @keyframes glitter {
            0% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); background: white; box-shadow: 0 0 25px #8ab2ff; }
            100% { opacity: 0.2; transform: scale(1); }
        }

        .donut-panel {
            position: relative;
            z-index: 20;
            width: 100%;
            max-width: 550px;
            background: rgba(8, 16, 30, 0.75);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid #334ÂçÅ‰∫î;
            border-radius: 38px;
            padding: 18px 16px 24px;
            box-shadow: 0 20px 40px -10px #000000, 0 0 0 1px #273c60 inset, 0 0 40px #142b4b;
            color: #d0e4ff;
            transition: all 0.2s;
            resize: both;
            overflow: auto;
            min-width: 320px;
            min-height: 600px;
        }

        .fullscreen-btn {
            position: absolute;
            top: 15px;
            right: 60px;
            background: #1a2f50;
            border: 1px solid #3f68a0;
            color: #b0ccff;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            z-index: 30;
            box-shadow: 0 4px 8px #00000060;
            transition: 0.2s;
        }

        .lang-switch {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #1a2f50;
            border: 1px solid #3f68a0;
            color: #b0ccff;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            cursor: pointer;
            z-index: 30;
            box-shadow: 0 4px 8px #00000060;
            transition: 0.2s;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #293f64;
            padding-bottom: 10px;
            margin-bottom: 14px;
            flex-wrap: wrap;
            padding-right: 100px;
        }

        .cell-block {
            background: #051020cc;
            border-radius: 34px;
            padding: 14px 12px;
            border: 1px solid #2b4770;
            margin-bottom: 16px;
        }

        .cell-rect {
            background: linear-gradient(145deg, #16263d, #0a1426);
            border-radius: 30px;
            padding: 14px 10px;
            border: 1px solid #3b5f90;
            box-shadow: inset 0 -3px 8px #1d3455, 0 8px 12px #00000080;
            transition: 0.3s;
        }

        .cell-rect.overheat {
            box-shadow: 0 0 40px #ff5e00, inset 0 0 20px #ff4500;
            border-color: #ff9933;
        }

        /* –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤ */
        .test-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }

        .test-btn {
            background: #0f2642;
            border: 1px solid #2f5090;
            color: #b5d0ff;
            padding: 12px 16px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            flex: 1 0 auto;
            min-width: 110px;
            box-shadow: 0 4px 0 #07162c;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .test-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #07162c;
        }

        .test-btn.active-test {
            background: #1f4280;
            border-color: #80b0ff;
            box-shadow: 0 0 20px #2f6bb0;
        }

        .secret-btn {
            background: #1d2c4a;
            border: 1px solid #7050c0;
            color: #d0b0ff;
            box-shadow: 0 4px 0 #2a1f4a;
        }

        .temp-slider {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #0e1e38;
            border-radius: 60px;
            padding: 8px 20px;
            margin: 10px 0;
        }

        .temp-slider span {
            font-size: 1.2rem;
            min-width: 70px;
        }

        input[type=range] {
            flex: 1;
            height: 8px;
            background: #1f3d70;
            border-radius: 20px;
            -webkit-appearance: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: #80b5ff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px #4090ff;
            border: 2px solid white;
        }

        .invest-row {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }

        .invest-btn {
            background: linear-gradient(145deg, #2a3f60, #12253f);
            border: 2px solid #b0d050;
            color: #e0ffb0;
            font-size: 1.8rem;
            padding: 15px 25px;
            border-radius: 70px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 0 30px #90d050;
            transition: 0.2s;
            flex: 1;
            text-align: center;
        }

        .invest-btn:active {
            transform: scale(0.98);
            background: #3f6080;
        }

        /* –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (—Ñ–æ—Ä–º—É–ª–∞, —Ü–µ–Ω–∞) */
        .floating-secret {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #081a32f0;
            backdrop-filter: blur(20px);
            border: 2px solid #c0a0ff;
            border-radius: 60px;
            padding: 30px 50px;
            color: white;
            font-size: 2rem;
            font-weight: 400;
            letter-spacing: 2px;
            box-shadow: 0 0 100px #b060ff;
            z-index: 200;
            transition: opacity 1.5s;
            opacity: 0;
            pointer-events: none;
            text-align: center;
        }

        .floating-secret.show {
            opacity: 1;
            transition: opacity 0.2s;
        }

        /* –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∫–∞–∫ –±—ã–ª–æ */
        .graph-area {
            background: #071129;
            border-radius: 32px;
            padding: 16px 10px;
            border: 1px solid #28497a;
            margin: 12px 0 18px;
        }

        canvas {
            width: 100%;
            height: auto;
            background: #030e1c;
            border-radius: 30px;
            display: block;
            border: 1px solid #1f3d66;
        }

        .live-temp {
            display: flex;
            gap: 15px;
            justify-content: space-around;
            font-size: 1rem;
        }

        .big-test-btn {
            background: linear-gradient(145deg, #1f314f, #0e1d33);
            border: 2px solid #3d6bb0;
            color: #c8ddff;
            font-size: 2.4rem;
            padding: 18px 20px;
            border-radius: 70px;
            text-align: center;
            font-weight: 300;
            letter-spacing: 5px;
            margin: 8px 0 18px;
            cursor: pointer;
            box-shadow: 0 8px 0 #09121f, 0 0 35px #25467a;
            transition: 0.1s;
        }

        .big-test-btn.running {
            background: #203b63;
            border-color: #90b8ff;
            box-shadow: 0 0 45px #3a76cc;
        }

        .footer-metrics {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: space-between;
            background: #0c2037;
            border-radius: 38px;
            padding: 12px 14px;
            border: 1px solid #30537d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
<div class="stars" id="starfield"></div>

<div class="donut-panel" id="mainPanel">
    <!-- –≤–µ—Ä—Ö–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ -->
    <div class="fullscreen-btn" id="fullscreenBtn" title="Fullscreen">‚õ∂</div>
    <div class="lang-switch" id="langBtn" title="Language">üåê</div>

    <div class="top-bar">
        <h2 id="headerTitle">‚ö° DONUT¬∑VTT</h2>
        <span id="headerSub">MX 26Ah ¬∑ 4.3V</span>
    </div>

    <!-- –±–∞—Ç–∞—Ä–µ—è -->
    <div class="cell-block">
        <div class="cell-rect" id="batteryRect">
            <div class="electrodes" style="display: flex; flex-wrap: wrap; justify-content: center; gap:8px;">
                <div style="width:14px;height:48px;background:#2c4b7a;border-radius:30px;"></div>
                <div style="width:14px;height:38px;background:#345f93;border-radius:30px;"></div>
                <div style="width:14px;height:48px;background:#2c4b7a;border-radius:30px;"></div>
                <div style="width:14px;height:38px;background:#345f93;border-radius:30px;"></div>
                <div style="width:14px;height:48px;background:#2c4b7a;border-radius:30px;"></div>
            </div>
            <div style="display:flex; justify-content:center; gap:18px; margin:12px 0;">
                <div style="width:45px;height:10px;background:#2b5580;border-radius:20px;"></div>
                <div style="width:45px;height:10px;background:#2b5580;border-radius:20px;"></div>
            </div>
        </div>
    </div>

    <!-- –°-—Ä–µ–∂–∏–º—ã (–æ—Å—Ç–∞–≤–∏–º –¥–ª—è —Ç–æ–∫–∞) -->
    <div style="display:flex; gap:8px; margin:10px 0;" id="cRates">
        <button class="test-btn" id="rate1C">1C</button>
        <button class="test-btn active-test" id="rate5C">5C</button>
        <button class="test-btn" id="rate11C">11C</button>
    </div>

    <!-- –Ω–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏: –¶–∏–∫–ª—ã, –ü–ª–æ—Ç–Ω–æ—Å—Ç—å, –°–æ—Å—Ç–∞–≤, –¶–µ–Ω–∞ -->
    <div class="test-grid">
        <button class="test-btn" id="cycleTestBtn">üîÅ 100k —Ü–∏–∫–ª–æ–≤</button>
        <button class="test-btn" id="densityTestBtn">üîã 405‚Äì422 –í—Ç¬∑—á/–∫–≥</button>
        <button class="test-btn secret-btn" id="formulaBtn">‚öóÔ∏è —Ñ–æ—Ä–º—É–ª–∞ üîí</button>
        <button class="test-btn secret-btn" id="priceBtn">üí∞ —Ü–µ–Ω–∞ üîí</button>
    </div>

    <!-- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä -->
    <div class="temp-slider">
        <span id="tempLabel">üå°Ô∏è -30¬∞C</span>
        <input type="range" id="tempSlider" min="-30" max="90" value="25" step="1">
        <span id="tempValue">+25¬∞C</span>
    </div>

    <!-- –≥—Ä–∞—Ñ–∏–∫ –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ -->
    <div class="graph-area">
        <div class="graph-header">
            <span id="graphTitle">üìà —Ç–µ—Ä–º–æ–ø—Ä–æ—Ñ–∏–ª—å T1/T2</span>
            <span id="avgTempLabel" style="background:#102b4a; padding:2px 16px; border-radius:40px;">24.3 ¬∞C</span>
        </div>
        <canvas id="tempCanvas" width="400" height="130"></canvas>
        <div class="live-temp">
            <span id="t1Val">üî• T1 24.5¬∞C</span>
            <span id="t2Val">‚ùÑÔ∏è T2 23.2¬∞C</span>
        </div>
    </div>

    <!-- –∫–Ω–æ–ø–∫–∞ –ü–£–°–ö/–°–¢–û–ü -->
    <div class="big-test-btn" id="testToggleBtn">‚ñ∂ –ü–£–°–ö</div>

    <!-- –∫–Ω–æ–ø–∫–∞ –ò–ù–í–ï–°–¢–ò–†–û–í–ê–¢–¨ -->
    <div class="invest-row">
        <div class="invest-btn" id="investBtn">üí∞ –ò–ù–í–ï–°–¢–ò–†–û–í–ê–¢–¨</div>
    </div>

    <!-- –Ω–∏–∂–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ -->
    <div class="footer-metrics" id="footerMetrics">
        <div class="metric-item"># —Ü–∏–∫–ª <span id="cycleVal">6</span></div>
        <div class="metric-item">‚ö° –µ–º–∫ <span id="capVal">26.19</span> Ah</div>
        <div class="metric-item">üîã —ç–Ω–µ—Ä–≥ <span id="enerVal">92.8</span> Wh</div>
        <div class="metric-item">üìä SOC <span id="socVal">98</span>%</div>
    </div>
</div>

<!-- –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–æ—à–∫–∏ –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤ -->
<div class="floating-secret" id="formulaPopup">‚öóÔ∏è Li¬∑Ti¬∑Gr¬∑Al¬∑S + –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä</div>
<div class="floating-secret" id="pricePopup">üí∞ —Ü–µ–Ω–∞ = Li-ion ¬∑ 1.0 (–ø–∞—Ä–∏—Ç–µ—Ç)</div>
<div class="floating-secret" id="investPopup">üöÄ –í–´ –ò–ù–í–ï–°–¢–û–† +1000%</div>

<script>
    (function() {
        // --- –∑–≤–µ–∑–¥—ã ---
        function initStars(container, count=90) {
            for (let i=0; i<count; i++) {
                let s = document.createElement('div');
                s.className = 'star';
                let size = Math.random() * 4 + 1.5;
                s.style.width = size + 'px';
                s.style.height = size + 'px';
                s.style.left = Math.random()*100 + '%';
                s.style.top = Math.random()*100 + '%';
                s.style.animationDelay = Math.random()*4 + 's';
                s.style.animationDuration = (Math.random()*4 + 3) + 's';
                container.appendChild(s);
            }
        }
        initStars(document.getElementById('starfield'));

        // --- —ç–ª–µ–º–µ–Ω—Ç—ã ---
        const canvas = document.getElementById('tempCanvas');
        const ctx = canvas.getContext('2d');
        const batteryRect = document.getElementById('batteryRect');

        // –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∏–º—É–ª—è—Ü–∏–∏
        let testActive = false;
        let currentRate = '5C';
        let cycle = 6, capacity = 26.19, energy = 92.8, soc = 98;
        let t1 = 24.5, t2 = 23.2;
        let ambientTemp = 25; // –æ—Ç —Å–ª–∞–π–¥–µ—Ä–∞

        // –∏—Å—Ç–æ—Ä–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        let histT1 = new Array(20).fill(t1);
        let histT2 = new Array(20).fill(t2);

        // –Ø–∑—ã–∫ (0-—Ä—É—Å—Å–∫–∏–π, 1-–∞–Ω–≥–ª–∏–π—Å–∫–∏–π, 2-–∫–∏—Ç–∞–π—Å–∫–∏–π)
        let lang = 0;
        const langData = {
            header: ['‚ö° DONUT¬∑VTT', '‚ö° DONUT¬∑VTT', '‚ö° Â§öÁ∫≥¬∑ÂÆûÈ™åÂÆ§'],
            cycleBtn: ['üîÅ 100k —Ü–∏–∫–ª–æ–≤', 'üîÅ 100k cycles', 'üîÅ 10‰∏áÊ¨°Âæ™ÁéØ'],
            densityBtn: ['üîã 405‚Äì422 –í—Ç¬∑—á/–∫–≥', 'üîã 405‚Äì422 Wh/kg', 'üîã 405‚Äì422 Áì¶Êó∂/ÂçÉÂÖã'],
            formulaBtn: ['‚öóÔ∏è —Ñ–æ—Ä–º—É–ª–∞ üîí', '‚öóÔ∏è formula üîí', '‚öóÔ∏è ÈÖçÊñπ üîí'],
            priceBtn: ['üí∞ —Ü–µ–Ω–∞ üîí', 'üí∞ price üîí', 'üí∞ ‰ª∑Ê†º üîí'],
            investBtn: ['üí∞ –ò–ù–í–ï–°–¢–ò–†–û–í–ê–¢–¨', 'üí∞ INVEST NOW', 'üí∞ Á´ãÂç≥ÊäïËµÑ'],
            startBtn: ['‚ñ∂ –ü–£–°–ö', '‚ñ∂ START', '‚ñ∂ ÂêØÂä®'],
            stopBtn: ['‚èπÔ∏è –°–¢–û–ü', '‚èπÔ∏è STOP', '‚èπÔ∏è ÂÅúÊ≠¢'],
            temp: ['üå°Ô∏è', 'üå°Ô∏è', 'üå°Ô∏è'],
            graph: ['üìà —Ç–µ—Ä–º–æ–ø—Ä–æ—Ñ–∏–ª—å T1/T2', 'üìà thermal T1/T2', 'üìà ÁÉ≠Êõ≤Á∫ø T1/T2'],
            cycleLabel: ['# —Ü–∏–∫–ª', 'cycle', 'Âæ™ÁéØ'],
            capLabel: ['‚ö° –µ–º–∫', '‚ö° cap', '‚ö° ÂÆπÈáè'],
            energyLabel: ['üîã —ç–Ω–µ—Ä–≥', 'üîã energy', 'üîã ËÉΩÈáè'],
            socLabel: ['üìä SOC', 'üìä SOC', 'üìä ÁîµËç∑'],
        };

        // --- —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —è–∑—ã–∫–∞ ---
        function updateLangUI() {
            document.getElementById('headerTitle').innerText = langData.header[lang];
            document.getElementById('cycleTestBtn').innerText = langData.cycleBtn[lang];
            document.getElementById('densityTestBtn').innerText = langData.densityBtn[lang];
            document.getElementById('formulaBtn').innerText = langData.formulaBtn[lang];
            document.getElementById('priceBtn').innerText = langData.priceBtn[lang];
            document.getElementById('investBtn').innerText = langData.investBtn[lang];
            document.getElementById('graphTitle').innerText = langData.graph[lang];
            if (!testActive) {
                document.getElementById('testToggleBtn').innerText = langData.startBtn[lang];
            } else {
                document.getElementById('testToggleBtn').innerText = langData.stopBtn[lang];
            }
            // –Ω–∏–∂–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (—á–µ—Ä–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–∏—Ñ—Ä)
        }

        // --- –≤—Å–ø–ª—ã–≤–∞—à–∫–∏ ---
        function showPopup(popupId) {
            const popup = document.getElementById(popupId);
            popup.classList.add('show');
            setTimeout(() => {
                popup.classList.remove('show');
            }, 5000);
        }

        // --- –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–æ–≤ ---
        document.getElementById('cycleTestBtn').addEventListener('click', ()=>{
            // –∏–º–∏—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –Ω–∞ 100k —Ü–∏–∫–ª–æ–≤
            showPopup('formulaPopup'); // –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º—É–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ–º–æ
            // –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
        });
        document.getElementById('densityTestBtn').addEventListener('click', ()=>{
            // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–æ—Ç–Ω–æ—Å—Ç—å (—á–∏—Å–ª–æ)
            const popup = document.getElementById('formulaPopup');
            popup.innerText = 'üîã 418 –í—Ç¬∑—á/–∫–≥ (—É—Å–ø–µ—Ö)';
            showPopup('formulaPopup');
            setTimeout(()=> popup.innerText = '‚öóÔ∏è Li¬∑Ti¬∑Gr¬∑Al¬∑S + –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä', 5000);
        });
        document.getElementById('formulaBtn').addEventListener('click', ()=>{
            showPopup('formulaPopup');
        });
        document.getElementById('priceBtn').addEventListener('click', ()=>{
            showPopup('pricePopup');
        });
        document.getElementById('investBtn').addEventListener('click', ()=>{
            showPopup('investPopup');
        });

        // --- —Å–ª–∞–π–¥–µ—Ä —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã ---
        const tempSlider = document.getElementById('tempSlider');
        const tempValueSpan = document.getElementById('tempValue');
        tempSlider.addEventListener('input', (e)=>{
            let val = e.target.value;
            tempValueSpan.innerText = (val>0?'+':'') + val + '¬∞C';
            ambientTemp = parseInt(val);
            // –≤–ª–∏—è–µ—Ç –Ω–∞ –±–∞–∑–æ–≤—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
        });

        // --- –æ—Å—Ç–∞–ª—å–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è (–∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏) ---
        function setActiveRate(rate) {
            document.getElementById('rate1C').classList.remove('active-test');
            document.getElementById('rate5C').classList.remove('active-test');
            document.getElementById('rate11C').classList.remove('active-test');
            if (rate==='1C') document.getElementById('rate1C').classList.add('active-test');
            if (rate==='5C') document.getElementById('rate5C').classList.add('active-test');
            if (rate==='11C') document.getElementById('rate11C').classList.add('active-test');
            currentRate = rate;
        }
        document.getElementById('rate1C').addEventListener('click',()=> setActiveRate('1C'));
        document.getElementById('rate5C').addEventListener('click',()=> setActiveRate('5C'));
        document.getElementById('rate11C').addEventListener('click',()=> setActiveRate('11C'));

        // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏—Å–ø–ª–µ–µ–≤
        function refreshDisplay() {
            document.getElementById('t1Val').innerHTML = `üî• T1 ${t1.toFixed(1)}¬∞C`;
            document.getElementById('t2Val').innerHTML = `‚ùÑÔ∏è T2 ${t2.toFixed(1)}¬∞C`;
            document.getElementById('avgTempLabel').innerText = ((t1+t2)/2).toFixed(1)+' ¬∞C';
            document.getElementById('cycleVal').innerText = cycle;
            document.getElementById('capVal').innerText = capacity.toFixed(2);
            document.getElementById('enerVal').innerText = energy.toFixed(1);
            document.getElementById('socVal').innerText = Math.floor(soc);
        }

        // –≥—Ä–∞—Ñ–∏–∫
        function drawChart() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.strokeStyle = '#5f9eff';
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            for (let i=0;i<histT1.length;i++) {
                let x = 15 + i*(canvas.width-30)/(histT1.length-1);
                let y = canvas.height-20 - (histT1[i]-15)*3;
                if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.stroke();
            ctx.strokeStyle = '#7fc9ff';
            ctx.beginPath();
            for (let i=0;i<histT2.length;i++) {
                let x = 15 + i*(canvas.width-30)/(histT2.length-1);
                let y = canvas.height-20 - (histT2[i]-15)*3;
                if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.stroke();
        }

        function simulationStep() {
            if (!testActive) return;
            let heat = (currentRate==='11C'?1.5: currentRate==='5C'?1.0:0.5);
            let ambientEffect = (ambientTemp - 25) * 0.03;
            t1 += (Math.random()-0.48)*heat*0.8 + ambientEffect;
            t2 += (Math.random()-0.52)*heat*0.7 + ambientEffect;
            t1 = Math.min(70, Math.max(15, t1));
            t2 = Math.min(68, Math.max(14, t2));
            capacity += (Math.random()-0.5)*0.03;
            capacity = Math.min(26.8, Math.max(25.6, capacity));
            energy = capacity*3.5 + Math.random()-0.5;
            soc = 90 + Math.random()*8;
            if (Math.random()>0.9) cycle = (cycle%15)+1;

            histT1.push(t1); histT2.push(t2);
            histT1.shift(); histT2.shift();
            refreshDisplay();
            drawChart();
            requestAnimationFrame(simulationStep);
        }

        document.getElementById('testToggleBtn').addEventListener('click', ()=>{
            testActive = !testActive;
            let btn = document.getElementById('testToggleBtn');
            if (testActive) {
                btn.innerText = langData.stopBtn[lang];
                btn.classList.add('running');
                simulationStep();
            } else {
                btn.innerText = langData.startBtn[lang];
                btn.classList.remove('running');
            }
        });

        // —è–∑—ã–∫
        document.getElementById('langBtn').addEventListener('click', ()=>{
            lang = (lang + 1) % 3;
            updateLangUI();
        });

        // fullscreen
        document.getElementById('fullscreenBtn').addEventListener('click', ()=>{
            if (!document.fullscreenElement) {
                document.getElementById('mainPanel').requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        refreshDisplay();
        drawChart();
        updateLangUI();
        for (let i=0;i<5;i++) {
            histT1.push(24+Math.random()*2);
            histT2.push(22+Math.random()*2.5);
        }
        histT1.splice(0,5); histT2.splice(0,5);
        drawChart();
    })();
</script>
</body>
</html>
