<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Рулетка</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: rgb(91, 107, 160);
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .ui-overlay {
            position: fixed;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 100;
        }
        
        .balance-text {
            font-size: 18px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div class="ui-overlay">
        <div class="balance-text">Баланс: 100</div>
        <div>Кликните на рулетку для вращения</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, rouletteWheel;
        let isSpinning = false;
        
        // Данные сектора из OBJ файла
        const sectorVertices = [
            [0.871418, 0.000000, -0.148808],
            [0.000077, 0.000000, -0.000028],
            [0.001686, 0.000000, 0.000015],
            [0.884061, 0.000000, 0.000617],
            [80.002892, -2.203763, 0.075245],
            [78.861351, -2.203763, -13.447731],
            [68.994087, -5.824495, -11.810030],
            [69.995773, -5.824494, 0.021153],
            [49.301624, -4.511277, -8.434131],
            [50.020695, -4.511277, 0.021154],
            [39.448170, -2.203763, -6.744274],
            [40.014412, -2.203763, 0.021154],
            [19.723009, 0.000000, -3.360104],
            [20.008930, 0.000000, 0.021154]
        ];
        
        const sectorFaces = [
            [2, 3, 0], [1, 2, 0], [7, 4, 5], [6, 7, 5],
            [8, 9, 7], [7, 6, 8], [10, 11, 9], [9, 8, 10],
            [12, 13, 11], [11, 10, 12], [9, 4, 7], [8, 5, 6]
        ];

        function init() {
            // Сцена
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x5b6ba0);
            
            // Камера
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 50, 100);
            camera.lookAt(0, 0, 0);
            
            // Рендерер
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Освещение
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 50);
            scene.add(directionalLight);
            
            // Создаем рулетку
            createRouletteWheel();
            
            // Обработчики событий
            renderer.domElement.addEventListener('click', spinRoulette);
            window.addEventListener('resize', onWindowResize);
            
            // Анимация
            animate();
        }
        
        function createRouletteWheel() {
            rouletteWheel = new THREE.Group();
            
            // Создаем 37 секторов
            for (let i = 0; i < 37; i++) {
                const sector = createSector(i);
                const angle = (i / 37) * Math.PI * 2;
                sector.rotation.y = angle;
                rouletteWheel.add(sector);
            }
            
            scene.add(rouletteWheel);
            
            // Начальный поворот для лучшего обзора
            rouletteWheel.rotation.x = Math.PI / 6;
        }
        
        function createSector(sectorIndex) {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const indices = [];
            
            // Создаем вершины для сектора
            sectorVertices.forEach(vertex => {
                vertices.push(...vertex);
            });
            
            // Создаем индексы для треугольников
            sectorFaces.forEach(face => {
                indices.push(face[0] - 1, face[1] - 1, face[2] - 1);
            });
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            geometry.setIndex(indices);
            geometry.computeVertexNormals();
            
            // Цвета секторов (европейская рулетка)
            let color;
            if (sectorIndex === 0) {
                color = 0x00ff00; // Зеленый для 0
            } else {
                color = (sectorIndex % 2 === 1) ? 0xff0000 : 0x000000; // Чередование красный/черный
            }
            
            const material = new THREE.MeshLambertMaterial({ color: color });
            const mesh = new THREE.Mesh(geometry, material);
            
            return mesh;
        }
        
        function spinRoulette() {
            if (isSpinning) return;
            
            isSpinning = true;
            const randomRotations = 5 + Math.random() * 5;
            const randomStopAngle = Math.random() * Math.PI * 2;
            const targetRotation = randomRotations * Math.PI * 2 + randomStopAngle;
            
            const startRotation = rouletteWheel.rotation.y;
            const startTime = Date.now();
            const duration = 4000;
            
            function animateSpin() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Плавное замедление
                const easeOut = 1 - Math.pow(1 - progress, 3);
                rouletteWheel.rotation.y = startRotation + targetRotation * easeOut;
                
                if (progress < 1) {
                    requestAnimationFrame(animateSpin);
                } else {
                    isSpinning = false;
                    // Определяем выигрышное число
                    const winningNumber = calculateWinningNumber(randomStopAngle);
                    alert(`Выпало число: ${winningNumber}`);
                }
            }
            
            animateSpin();
        }
        
        function calculateWinningNumber(stopAngle) {
            // Европейская рулетка: 0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26
            const numbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
            const index = Math.floor((1 - (stopAngle / (Math.PI * 2))) * 37) % 37;
            return numbers[index];
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (!isSpinning) {
                // Медленное вращение в покое
                rouletteWheel.rotation.y += 0.001;
            }
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Запуск
        init();
    </script>
</body>
</html>
